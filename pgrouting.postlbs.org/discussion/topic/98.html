<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

  
  

  


  

  
<!-- Mirrored from pgrouting.postlbs.org/discussion/topic/98 by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 20 Nov 2010 01:59:35 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
    <title>
      Message List – pgRouting
    </title>
        <link rel="search" href="../../search.html" />
        <link rel="help" href="../../wiki/TracGuide.html" />
        <link rel="start" href="../../wiki.html" />
        <link rel="stylesheet" href="../../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../../chrome/common/css/wiki.css" type="text/css" /><link rel="stylesheet" href="../../chrome/discussion/css/discussion.css" type="text/css" /><link rel="stylesheet" href="../../chrome/discussion/css/admin.css" type="text/css" />
        <link rel="shortcut icon" href="../../chrome/site/pgRouting.ico" type="image/x-icon" />
        <link rel="icon" href="../../chrome/site/pgRouting.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../../search/opensearchhtml.html" title="Search pgRouting" />
    <script type="text/javascript" src="../../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../../chrome/common/js/trac.js"></script><script type="text/javascript" src="../../chrome/common/js/search.js"></script><script type="text/javascript" src="../../chrome/common/js/wikitoolbar.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript">
      $(document).ready(function() {
        $("#content").find("h1,h2,h3,h4,h5,h6").addAnchor("Link to this section");
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../../chrome/site/css/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="../../index.html"><img src="../../chrome/site/slonik2_11.gif" alt="" height="126" /></a>
      </div>
      <form id="search" action="http://pgrouting.postlbs.org/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="../../login.html">Login</a></li><li><a href="../../prefs.html">Preferences</a></li><li class="last"><a href="../../register.html">Register</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../../wiki.html">Home</a></li><li><a href="../../timeline.html">Timeline</a></li><li><a href="../../roadmap.html">Roadmap</a></li><li><a href="../../browser.html">Browse Source</a></li><li><a href="../../report.html">View Tickets</a></li><li><a href="../../search.html">Search</a></li><li class="last active"><a href="../../discussion.html">Forum</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><a href="../../discussion.html">Forum Index</a></li><li class="last"><a href="../forum/22.html" title="demo">demo</a></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="discussion searchable">
      <div id="message-list" class="message-list">
        <h1>demo (#22) - Don't get the tutorium running (#98) - Message List</h1>
      <div class="topic new">
        <a name="topic"></a>
        <div class="header">
            <div class="subject">
              Don't get the tutorium running
            </div>
            <div class="body">
              <p>
Dear list,
I again tried to start the pgRouting/Open Layers tutorium.
My application runs under:
</p>
<p>
<a class="ext-link" href="http://www.tourismus-maps.de/behncke/tutorial_ol/06.index.html"><span class="icon"> </span>http://www.tourismus-maps.de/behncke/tutorial_ol/06.index.html</a>
</p>
<p>
But I don`t get it to run.
I can set start and endpoints but after pressing on "Caluculate Route" nothing happens?
</p>
<p>
In the background I have my database that looks like:
</p>
<p>
<a class="ext-link" href="http://www.tourismus-maps.de/behncke/bilder/screenshot_routing_ol.PNG"><span class="icon"> </span>http://www.tourismus-maps.de/behncke/bilder/screenshot_routing_ol.PNG</a>
</p>
<p>
Also the routing functions are in that database.
</p>
<p>
Does anybody can give me a hint what might be the problem?
</p>
<p>
Thank you very much, Kai
</p>
            </div>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 17:31:42 (3 years ago)
          </div>
        </div>
      </div>
      <div class="replies new">
    <div class="set-display">
      Tree View
      <a href="http://pgrouting.postlbs.org/discussion/topic/98?discussion_action=set-display;display=flat-desc#topic">Flat View (newer first)</a>
      <a href="http://pgrouting.postlbs.org/discussion/topic/98?discussion_action=set-display;display=flat-asc#topic">Flat View (older first)</a>
    </div>
        <ul class="reply">
    <li class="new">
        <a name="message369"></a>
        <div class="id">
          Message #369
        </div>
        <div class="body">
            <p>
Hi Kai,
</p>
<p>
On your server you get the following PHP Warning:
</p>
<pre class="wiki">&lt;b&gt;Warning&lt;/b&gt;:  pg_query(): supplied argument is not a
valid PostgreSQL link resource in &lt;b&gt;/home/promotion
/behncke/tutorial_ol/ax_routing.php&lt;/b&gt; on line &lt;b&gt;131&lt;/b&gt;
</pre><p>
Probably something wrong with the SQL statement. Can you post the generated SQL query string here? Also, are you sure your connection to PostgreSQL is working?
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            daniel
          </div>
          <div class="time">
            01/17/08 17:45:22 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message370"></a>
        <div class="id">
          Message #370
        </div>
        <div class="body">
            <p>
Hi Daniel,
the connection to the PostgreSQL-Server works fine.
I tested it with:
</p>
<blockquote>
<p>
if  ($con = pg_connect("dbname=".PG_DB." password=".PG_PASSWORD." host=".PG_HOST." user=".PG_USER))
</p>
<blockquote>
<p>
echo "Connection works!";
else echo "Connection does not work";
</p>
</blockquote>
</blockquote>
<p>
The sql-String and the next connection test looks like:
</p>
<blockquote>
<p>
$sql = "SELECT gid, source, target, the_geom,
</p>
<blockquote>
<p>
distance(the_geom, <a class="missing wiki">GeometryFromText?</a>(
</p>
</blockquote>
<p>
'POINT(".$lonlat<a class="missing changeset" title="No changeset 0 in the repository">[0]</a>." ".$lonlat<a class="changeset" href="../../changeset/1.html" title="Initial import">[1]</a>.")', 54004)) AS dist
</p>
</blockquote>
<blockquote>
<p>
FROM ".TABLE."
WHERE the_geom &amp;&amp; setsrid(
</p>
<blockquote>
<p>
'BOX3D(".($lonlat<a class="missing changeset" title="No changeset 0 in the repository">[0]</a>-200)."
</p>
<blockquote>
<p>
".($lonlat<a class="changeset" href="../../changeset/1.html" title="Initial import">[1]</a>-200).",
".($lonlat<a class="missing changeset" title="No changeset 0 in the repository">[0]</a>+200)."
".($lonlat<a class="changeset" href="../../changeset/1.html" title="Initial import">[1]</a>+200).")'::box3d, 54004)
</p>
</blockquote>
</blockquote>
<p>
ORDER BY dist LIMIT 1";
</p>
</blockquote>
<p>
</p>
<blockquote>
<p>
if ($query = pg_query($con,$sql)) echo "Verbindung klappt";
else echo "Fehler";
</p>
</blockquote>
<p>
Might there be an error in the SQL-statement?
Thank you very much, Kai
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 17:56:10 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message371"></a>
        <div class="id">
          Message #371
        </div>
        <div class="body">
            <p>
Maybe you can insert
</p>
<pre class="wiki">error_log($sql);
</pre><p>
into the php script to write the generated SQL statement to the error log. Then look into the server log and you can copy and execute it directly in PostgreSQL and see if it works or not.
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            daniel
          </div>
          <div class="time">
            01/17/08 18:05:06 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message372"></a>
        <div class="id">
          Message #372
        </div>
        <div class="body">
            <p>
Hi Daniel, thank you again. I checked that out.
</p>
<p>
No problems with the sql-strings.
The first one is:
SELECT gid, source, target, the_geom,
</p>
<blockquote>
<p>
distance(the_geom, <a class="missing wiki">GeometryFromText?</a>(
</p>
</blockquote>
<blockquote>
<p>
'POINT(-13734128.805252185 6147755.471565573)', 54004)) AS dist
</p>
</blockquote>
<blockquote>
<p>
FROM victoria
WHERE the_geom &amp;&amp; setsrid(
</p>
<blockquote>
<p>
'BOX3D(-13734328.8053
</p>
<blockquote>
<p>
6147555.47157,
-13733928.8053
6147955.47157)'::box3d, 54004)
</p>
</blockquote>
</blockquote>
<p>
ORDER BY dist LIMIT 1
</p>
</blockquote>
<p>
....and gave a clean result.
</p>
<p>
The second one (in case of shortest path dijkstra) is:
SELECT rt.gid, <a class="missing wiki">AsText?</a>(rt.the_geom) AS wkt,
</p>
<blockquote>
<p>
length(rt.the_geom) AS length, victoria.id
</p>
</blockquote>
<blockquote>
<p>
FROM victoria,
</p>
<blockquote>
<p>
(SELECT gid, the_geom
</p>
<blockquote>
<p>
FROM dijkstra_sp_delta(
</p>
<blockquote>
<p>
'victoria',
123,
124,
3000)
</p>
</blockquote>
</blockquote>
<p>
) as rt WHERE victoria.gid=rt.gid;
</p>
</blockquote>
</blockquote>
<p>
...no problem in Postgresql.
</p>
<p>
I wrote these both SQL-string fix in the ax_routing.php but I still get an error at that line:
</p>
<blockquote>
<p>
$query = pg_query($con,$sql);
</p>
</blockquote>
<p>
...supplied argument is not a valid PostgreSQL link resource
</p>
<p>
I think I need to dive a bit deeper in that syntax.
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 18:45:44 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message373"></a>
        <div class="id">
          Message #373
        </div>
        <div class="body">
            <p>
Oh, I had an error in the second connection,
I cleared that. But now I get:
</p>
<p>
Warning: Cannot modify header information - headers already sent by (output started at /home/promotion/behncke/tutorial_ol/ax_routing.php:48) in /home/promotion/behncke/tutorial_ol/ax_routing.php on line 207
</p>
<p>
Oh deer, that`s more difficult than I thought............
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 19:05:18 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message375"></a>
        <div class="id">
          Message #375
        </div>
        <div class="body">
            <p>
Maybe you forgot to remove some output like
</p>
<pre class="wiki">echo "xyz";
print("xyz");
</pre><p>
This usually leads to this error. There shouldn't be any kind of text output before setting the XML header part.
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            daniel
          </div>
          <div class="time">
            01/17/08 19:49:26 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message376"></a>
        <div class="id">
          Message #376
        </div>
        <div class="body">
            <p>
Great, that was it :-)
</p>
<p>
I also put away the static SQL-Values and work now with the originall scripts and it wokrs fine!!!!
Thank you again very much
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 19:59:45 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message377"></a>
        <div class="id">
          Message #377
        </div>
        <div class="body">
            <p>
That's good news! Just one remark:
</p>
<p>
The tutorial was made for the FOSS4G2007. That time <a class="missing wiki">OpenLayers?</a> used 54004 projection for Google Maps layers. In the meanwhile (since version 2.5) there is a better solution with a customized Google projection (EPSG:900913).
</p>
<p>
I recommend you to update to the current version. Otherwise you always need to keep the older <a class="missing wiki">OpenLayers?</a> code. It shouldn't be that difficult.
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            daniel
          </div>
          <div class="time">
            01/17/08 20:06:51 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message379"></a>
        <div class="id">
          Message #379
        </div>
        <div class="body">
            <p>
All right, so you mean just to put the transform(the_geom,900913)-command in SQL and than I can put in the actual <a class="missing wiki">OpenLayers?</a>-Code in the tutorium?
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 20:19:53 (3 years ago)
          </div>
        </div>
      <ul class="reply">
    <li class="new">
        <a name="message380"></a>
        <div class="id">
          Message #380
        </div>
        <div class="body">
            <p>
For example ... reproject start/end as well as result. Or reproject the the complete table. That's up to you.
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            daniel
          </div>
          <div class="time">
            01/17/08 20:26:52 (3 years ago)
          </div>
        </div>
      <ul class="reply">
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li><li class="new">
        <a name="message378"></a>
        <div class="id">
          Message #378
        </div>
        <div class="body">
            <p>
Great, that was it :-)
</p>
<p>
I also put away the static SQL-Values and work now with the originall scripts and it wokrs fine!!!!
Thank you again very much
</p>
        </div>
        <div class="controls">
        </div>
        <div class="footer">
          <div class="author">
            Kai-Behncke
          </div>
          <div class="time">
            01/17/08 20:18:14 (3 years ago)
          </div>
        </div>
      <ul class="reply">
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
        <li></li>
      </ul>
    </li>
          <li></li>
        </ul>
    <div class="set-display">
      Tree View
      <a href="http://pgrouting.postlbs.org/discussion/topic/98?discussion_action=set-display;display=flat-desc#topic">Flat View (newer first)</a>
      <a href="http://pgrouting.postlbs.org/discussion/topic/98?discussion_action=set-display;display=flat-asc#topic">Flat View (older first)</a>
    </div>
        
        <div class="attachments">
        </div>
      </div>
      </div>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">
        Powered by <a href="../../about.html"><strong>Trac 0.11.5rc1</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.
      </p>
      <p class="right">pgRouting is a project of PostLBS <br /><a href="http://www.postlbs.org/">http://www.postlbs.org/</a></p>
    </div>
  </body>
