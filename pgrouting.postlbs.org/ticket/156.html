<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  
  

  


  

  
<!-- Mirrored from pgrouting.postlbs.org/ticket/156 by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 20 Nov 2010 02:17:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
<head>
    <title>
          #156 (Return sequence number with shortest_path_astar)
     – pgRouting
    </title>
        <link rel="search" href="../search.html" />
        <link rel="prev" href="126.html" title="Ticket #126" />
        <link rel="last" href="109.html" title="Ticket #109" />
        <link rel="help" href="../wiki/TracGuide.html" />
        <link rel="alternate" href="http://pgrouting.postlbs.org/ticket/156?format=csv" type="text/csv" class="csv" title="Comma-delimited Text" /><link rel="alternate" href="http://pgrouting.postlbs.org/ticket/156?format=tab" type="text/tab-separated-values" class="tab" title="Tab-delimited Text" /><link rel="alternate" href="http://pgrouting.postlbs.org/ticket/156?format=rss" type="application/rss+xml" class="rss" title="RSS Feed" />
        <link rel="up" href="http://pgrouting.postlbs.org/report/9?USER=anonymous&amp;page=1" />
        <link rel="next" href="5.html" title="Ticket #5" />
        <link rel="start" href="../wiki.html" />
        <link rel="stylesheet" href="../chrome/common/css/trac.css" type="text/css" /><link rel="stylesheet" href="../chrome/common/css/ticket.css" type="text/css" />
        <link rel="first" href="138.html" title="Ticket #138" />
        <link rel="shortcut icon" href="../chrome/site/pgRouting.ico" type="image/x-icon" />
        <link rel="icon" href="../chrome/site/pgRouting.ico" type="image/x-icon" />
      <link type="application/opensearchdescription+xml" rel="search" href="../search/opensearchhtml.html" title="Search pgRouting" />
    <script type="text/javascript" src="../chrome/common/js/jquery.js"></script><script type="text/javascript" src="../chrome/common/js/trac.js"></script><script type="text/javascript" src="../chrome/common/js/search.js"></script>
    <!--[if lt IE 7]>
    <script type="text/javascript" src="/chrome/common/js/ie_pre7_hacks.js"></script>
    <![endif]-->
    <script type="text/javascript" src="../chrome/common/js/wikitoolbar.js"></script><script type="text/javascript">
      jQuery(document).ready(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6").addAnchor("Link to this section");
        $("#changelog h3.change").addAnchor("Link to this change");
        /* only enable control elements for the currently selected action */
        var actions = $("#action input[name='action']");
        function updateActionFields() {
          actions.each(function () {
            $(this).siblings().find("*[@id]").enable($(this).checked());
            $(this).siblings().filter("*[@id]").enable($(this).checked());
          });
        }
        actions.click(updateActionFields);
        updateActionFields();
      });
    </script>
    <link rel="stylesheet" type="text/css" href="../chrome/site/css/style.css" />
  </head>
  <body>
    <div id="banner">
      <div id="header">
        <a id="logo" href="../index.html"><img src="../chrome/site/slonik2_11.gif" alt="" height="126" /></a>
      </div>
      <form id="search" action="http://pgrouting.postlbs.org/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18" value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
      <div id="metanav" class="nav">
    <ul>
      <li class="first"><a href="../login.html">Login</a></li><li><a href="../prefs.html">Preferences</a></li><li class="last"><a href="../register.html">Register</a></li>
    </ul>
  </div>
    </div>
    <div id="mainnav" class="nav">
    <ul>
      <li class="first"><a href="../wiki.html">Home</a></li><li><a href="../timeline.html">Timeline</a></li><li><a href="../roadmap.html">Roadmap</a></li><li><a href="../browser.html">Browse Source</a></li><li class="active"><a href="../report.html">View Tickets</a></li><li><a href="../search.html">Search</a></li><li class="last"><a href="../discussion.html">Forum</a></li>
    </ul>
  </div>
    <div id="main">
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
          <ul>
              <li class="first"><span>&larr; <a class="prev" href="126.html" title="Ticket #126">Previous Ticket</a></span></li><li><a href="http://pgrouting.postlbs.org/report/9?USER=anonymous&amp;page=1">Back to Query</a></li><li class="last"><span><a class="next" href="5.html" title="Ticket #5">Next Ticket</a> &rarr;</span></li>
          </ul>
        <hr />
      </div>
    <div id="content" class="ticket">
      <h1>
              Ticket #156
          <span class="status">(closed bug report: invalid)</span>
      </h1>
      <!-- Do not show the ticket (pre)view when the user first comes to the "New Ticket" page.
           Wait until they hit preview. -->
        <!-- Ticket Box (ticket fields along with description) -->
        <div id="ticket">
          <div class="date">
            <p>Opened <a class="timeline" href="http://pgrouting.postlbs.org/timeline?from=2009-04-29T08%3A53%3A39%2B0900&amp;precision=second" title="2009-04-29T08:53:39+0900 in Timeline">19 months</a> ago</p>
            <p>Last modified <a class="timeline" href="http://pgrouting.postlbs.org/timeline?from=2009-04-30T09%3A28%3A03%2B0900&amp;precision=second" title="2009-04-30T09:28:03+0900 in Timeline">19 months</a> ago</p>
          </div>
          <!-- use a placeholder if it's a new ticket -->
          <h2 class="summary searchable">Return sequence number with shortest_path_astar</h2>
          <table class="properties">
            <tr>
              <th id="h_reporter">Reported by:</th>
              <td headers="h_reporter" class="searchable">curtis.paris@…</td>
              <th id="h_owner">Owned by:</th>
              <td headers="h_owner">somebody
              </td>
            </tr>
            <tr>
                <th id="h_priority">
                  Priority:
                </th>
                <td headers="h_priority">
                      minor
                </td>
                <th id="h_milestone">
                  Milestone:
                </th>
                <td headers="h_milestone">
                      <a class="milestone" href="../milestone/Version%201.html">Version 1.1</a>
                </td>
            </tr><tr>
                <th id="h_component">
                  Component:
                </th>
                <td headers="h_component">
                      A*
                </td>
                <th id="h_version">
                  Version:
                </th>
                <td headers="h_version">
                      1.03
                </td>
            </tr><tr>
                <th id="h_keywords">
                  Keywords:
                </th>
                <td headers="h_keywords" class="searchable">
                </td>
                <th id="h_cc">
                  Cc:
                </th>
                <td headers="h_cc" class="searchable">
                </td>
            </tr>
          </table>
            <div class="description">
              <h3 id="comment:description">
                Description
              </h3>
              <div class="searchable">
                <p>
When using shortest_path_astar, there is no sequence number returned. 
</p>
<p>
If you use the results to joint to another table, the sequence is not guaranteed and is often invalid for calculating a route.  It requires that the consumer must resort and rejoin edges together from start to finish.
</p>
<p>
Postgres 8.4 will have a row number function, but 8.3 does not.  The ways of generating a row number are gross when using functions today.  It would be best if the function could return a row number.
</p>
<p>
My implementation has changed to do this by:
routing_core.sql:
CREATE TYPE path_result AS (vertex_id integer, edge_id integer, cost float8, sequence integer);
</p>
<p>
This was already attemped in the C files:
</p>
<blockquote>
<p>
/* This will work for some compilers. If it crashes with segfault, try to change the following block with this one
</p>
</blockquote>
<blockquote>
<blockquote>
<p>
values = palloc(4 * sizeof(Datum));
nulls = palloc(4 * sizeof(char));
</p>
</blockquote>
</blockquote>
<blockquote>
<blockquote>
<p>
values<a class="missing changeset" title="No changeset 0 in the repository">[0]</a> = call_cntr;
nulls<a class="missing changeset" title="No changeset 0 in the repository">[0]</a> = ' ';
</p>
</blockquote>
</blockquote>
<p>
The problem is that you should probably be casting it using the Int32GetDatum, such as:
</p>
<blockquote>
<p>
values<a class="changeset" href="../changeset/3.html" title="initial">[3]</a> = Int32GetDatum(call_cntr);
nulls<a class="changeset" href="../changeset/3.html" title="initial">[3]</a> = ' ';
</p>
</blockquote>
<p>
In my own wrapper I put the value at the END of the list.  This is for backward compatability.  If the tuple returns data that the function prototype does not consume, there is no harm.  But, if the user updates their function definitions, they can get the sequence.
</p>

              </div>
            </div>
        </div>
          <h2>Change History</h2>
          <div id="changelog">
            <form method="get" action="#comment" class="printableform">
              <div class="change">
                <h3 class="change" id="comment:1">
                  Changed <a class="timeline" href="http://pgrouting.postlbs.org/timeline?from=2009-04-30T09%3A28%3A03%2B0900&amp;precision=second" title="2009-04-30T09:28:03+0900 in Timeline">19 months</a> ago by anton
                </h3>
      <ul class="changes">
        <li>
          <strong>status</strong>
              changed from <em>new</em> to <em>closed</em>
        </li><li>
          <strong>resolution</strong>
              set to <em>invalid</em>
        </li>
      </ul>
      <div class="comment searchable">
        <p>
You are using core function (shortest_path_astar). Please look at core/sql/routing_core_wrappers.sql file to find more sophisticated wrappers - all of them return sequence numbers.
</p>

      </div>
              </div>
            </form>
          </div>
      <div id="help">
        <strong>Note:</strong> See
        <a href="../wiki/TracTickets.html">TracTickets</a> for help on using
        tickets.
      </div>
    </div>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="http://pgrouting.postlbs.org/ticket/156?format=csv" class="csv">Comma-delimited Text</a>
        </li><li>
          <a rel="nofollow" href="http://pgrouting.postlbs.org/ticket/156?format=tab" class="tab">Tab-delimited Text</a>
        </li><li class="last">
          <a rel="nofollow" href="http://pgrouting.postlbs.org/ticket/156?format=rss" class="rss">RSS Feed</a>
        </li>
      </ul>
    </div>
    </div>
    <div id="footer" lang="en" xml:lang="en"><hr />
      <a id="tracpowered" href="http://trac.edgewall.org/"><img src="../chrome/common/trac_logo_mini.png" height="30" width="107" alt="Trac Powered" /></a>
      <p class="left">
        Powered by <a href="../about.html"><strong>Trac 0.11.5rc1</strong></a><br />
        By <a href="http://www.edgewall.org/">Edgewall Software</a>.
      </p>
      <p class="right">pgRouting is a project of PostLBS <br /><a href="http://www.postlbs.org/">http://www.postlbs.org/</a></p>
    </div>
  
<!-- Google Analytics Widget Code -->
<script type="text/javascript">
  var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
  document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
  try {
    jQuery(document).ready( function() {
      var pageTracker = _gat._getTracker("UA-9766327-1");
      jQuery('a').each( function() {
        var url;
        if ( this.href.match("156.html\/\/pgrouting.postlbs.org") ) {
          if ( this.href.match(/\.(zip|tar|tar.gz|tar.bzip|egg)$/) ) {
            url = this.pathname + this.search;
          };
        } else {
          var port = '';
          if ( this.port != '') port = ':'+this.port;
          url = '/external/' + this.hostname + port + this.pathname + this.search;
        };
        if ( url ) {
          if ( ! url.match('%5e.html\/attachment\/') ) {
            jQuery(this).click( function() {
              pageTracker._trackPageview(url);
            });
          };
        };
      });
    pageTracker._trackPageview();
    });
  } catch(err) {}
</script>
<!-- Google Analytics Widget Code Ended -->
</body>

<!-- Mirrored from pgrouting.postlbs.org/ticket/156 by HTTrack Website Copier/3.x [XR&CO'2010], Sat, 20 Nov 2010 02:17:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8"><!-- /Added by HTTrack -->
</html>